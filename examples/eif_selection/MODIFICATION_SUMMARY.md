# EIF 选择项目修改总结

## 修改概述

本项目已从 ILF（内部逻辑文件）选择成功修改为 EIF（外部接口文件）选择。这是一个从需求文档中识别和选择所有 EIF 功能点的项目。

## 主要修改内容

### 1. 判断标准更新

EIF 的三个核心判断条件：

1. **逻辑上独立且用户可识别**
   - 数据组在逻辑上是独立的、完整的实体
   - 用户能够识别和理解这个数据组的业务含义

2. **被当前应用引用，但物理/逻辑上存在于当前应用之外**
   - 数据由外部系统或应用维护
   - 当前应用通过接口访问该数据
   - 数据存储在应用边界之外

3. **不由当前应用进行维护（即只读，不增删改）**
   - 当前应用只能读取该数据
   - 不能对该数据进行增加、删除或修改操作
   - 数据的维护由其他应用或系统负责

### 2. 文件修改详情

#### eif_selection.py

**函数名和变量修改：**
- ✅ `normalize_ilf_name` → `normalize_eif_name`
- ✅ `check_ilf_semantic_similarity` → `check_eif_semantic_similarity`
- ✅ `calculate_ilf_similarity` → `calculate_eif_similarity`
- ✅ `test_ilf_assessment` → `test_eif_assessment`
- ✅ `_clean_ilf_name` → `_clean_eif_name`
- ✅ 所有 `ilf_list` → `eif_list`
- ✅ 所有 `ilf_text` → `eif_text`
- ✅ 所有 `ilf_name` → `eif_name`
- ✅ 所有 `true_ilf` → `true_eif`

**提示词模板更新：**
- ✅ `io_prompt`: 更新为识别 EIF 功能点
- ✅ `cot_prompt`: 更新分析步骤，包含：
  1. 识别外部数据源/接口
  2. 判断是否逻辑上独立且用户可识别
  3. 判断是否存在于应用之外
  4. 判断是否只读访问
  
- ✅ `tot_prompt`: 更新深入分析部分：
  - 初步识别：列出所有外部数据源/接口
  - 深入分析：数据组特征、数据位置与访问方式
  
- ✅ `got_prompt`: 更新多路径验证：
  - 路径1（用户视角）：外部数据组用户可识别性
  - 路径2（系统视角）：数据存在于应用之外、只读引用
  - 路径3（IFPUG规则视角）：符合EIF定义和条件
  
- ✅ `tot_improve_prompt`: 更新改进提示，重新验证 EIF 的三个关键条件

- ✅ `perspective_prompt`: 更新三个视角的关注点：
  - 用户视角：逻辑独立性、用户可识别性
  - 系统视角：数据位置、访问方式（只读/读写）
  - IFPUG规则视角：EIF的三个必要条件
  
- ✅ `merge_prompt`: 更新合并提示：
  - 必要条件：逻辑独立、外部存储、只读引用
  - 排除条件：有写操作、内部存储、非逻辑独立

**Parser 更新：**
- ✅ `extract_answer`: 更新提取 EIF 功能点列表的逻辑
- ✅ 更新所有正则表达式模式，从 "ILF功能点列表" 改为 "EIF功能点列表"
- ✅ 更新所有输出格式标记

**评分和测试函数：**
- ✅ 使用 `calculate_eif_similarity` 进行语义相似度判断
- ✅ 更新所有注释和文档字符串

#### README.md

- ✅ 更新主要关注点：从 ILF 改为 EIF
- ✅ 更新方法设计：
  - 候选项识别：识别外部数据源/接口
  - 规则验证：EIF的三个条件
  - 结果聚合：生成 EIF 列表
  
- ✅ 更新操作定义：
  - Generate操作：增加"数据来源和位置"、"访问方式"
  - 所有操作：ILF → EIF
  
- ✅ 新增"EIF 判断标准"章节：详细说明三个判断条件
- ✅ 更新示例数据说明：强调外部系统数据引用场景
- ✅ 更新执行命令：`python eif_selection.py`
- ✅ 更新参考资料：增加 EIF 相关内容

### 3. 关键差异对比（ILF vs EIF）

| 特性 | ILF | EIF |
|------|-----|-----|
| 数据位置 | 应用边界内 | 应用边界外 |
| 维护方式 | 由当前应用维护 | 由其他应用维护 |
| 访问权限 | 完整的CRUD操作 | 只读（只引用） |
| 数据所有权 | 当前应用拥有 | 外部系统拥有 |
| 识别重点 | 内部数据管理 | 外部数据接口 |

### 4. 提示词优化重点

所有提示词现在强调：
- ✅ 识别外部数据源和接口
- ✅ 检查数据是否在应用边界之外
- ✅ 验证应用是否只进行读取操作
- ✅ 确认数据由外部系统维护
- ✅ 排除有增删改操作的情况
- ✅ 排除内部存储的数据

### 5. 语义相似度判断优化

- ✅ 更新语义相似度判断提示，专注于外部数据源的匹配
- ✅ 考虑中英文翻译、同义词、缩写等因素
- ✅ 支持使用 LLM 进行高质量语义匹配

## 使用说明

运行 EIF 选择实验：

```bash
python eif_selection.py
```

确保 `eif_selection.csv` 文件包含正确的 EIF 样本数据。数据格式：
```csv
doc_id,true_eif,requirement_text
1,"职位信息, 员工信息","[需求文档内容]"
```

## 测试建议

1. **验证纯外部数据引用场景**（应识别为 EIF）
   - 从其他系统读取数据
   - 只有查询/显示操作
   - 明确说明数据来源在外部

2. **验证有增删改操作的场景**（不应识别为 EIF）
   - 应用对数据有修改权限
   - 存在创建、更新或删除操作

3. **验证内部维护的数据**（不应识别为 EIF）
   - 数据存储在当前应用数据库
   - 由当前应用进行维护

4. **验证混合场景**
   - 同时有内部和外部数据
   - 正确区分 ILF 和 EIF

## 注意事项

- 数据文件格式已更新为 CSV 格式，包含 `doc_id`, `true_eif`, `requirement_text` 三列
- `true_eif` 列包含逗号分隔的 EIF 功能点名称列表
- 所有测试用例的 ground_truth 应该基于 EIF 标准重新标注
- 支持使用 LLM 进行语义相似度判断，提高匹配准确率
- 建议使用实际的 EIF 场景数据进行测试验证

## 项目特点

与 `eif_judge` 项目的区别：
- `eif_judge`: 判断单个候选功能点是否为 EIF（二分类问题）
- `eif_selection`: 从整个需求文档中选择和识别所有 EIF 功能点（多标签选择问题）

本项目的优势：
- 一次性分析整个需求文档
- 自动识别所有外部接口
- 支持语义相似度匹配
- 提供详细的分析过程

